filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(grepl("_NM", metroreg)) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>% head()
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(grepl("_NM", metroreg)) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>% head()
library(forcats)
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"))) %>%
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"))) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg)) %>%
geom_line()
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"))) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg)) +
geom_line()
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
high_reg = fct_rev(high_reg)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg)) +
geom_line()
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
high_reg = fct_relevel(high_reg, "muut", after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg)) +
geom_line()
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
high_reg = fct_relevel(high_reg, "muut")) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg)) +
geom_line()
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"))) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg)) +
geom_line()
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg)) +
geom_line()
eurostat::ea_countries
countries <- c("BE", "DE", "IE", "ES", "IT", "NL", "AT", "PT", "FI")
countries <- c("BE", "DE", "IE", "ES", "IT", "NL", "AT", "PT", "FI", "SE", "DK")
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg)) +
geom_line()
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>% filter(net_mig_share > 2.5)
countries <- c("BE", "DE", "FR", "IE", "NL", "AT", "PT", "FI", "SE", "DK")
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>% filter(net_mig_share > 2.5)
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg)) +
geom_line()
library(ggptt)
set_ptt()
# eurostat::ea_countries
countries <- c("BE", "DE", "FR", "IE", "NL", "AT", "PT", "FI", "SE", "DK")
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg)) +
geom_line()
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(muut = 0.5))
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,0.5))
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,0.3))
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,0.3)) +
geom_h0() +
scale_y_continuous(limits = c(-1, 2.5))
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
bind_rows(summarise_all(., sum)) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,0.3)) +
geom_h0() +
scale_y_continuous(limits = c(-1, 2.5))
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
bind_rows(summarise_if(., is.numeric, sum)) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,0.3)) +
geom_h0() +
scale_y_continuous(limits = c(-1, 2.5))
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
stat_summary(fun.y = "mean", colour = "red", size = 2, geom = "line") +
scale_alpha_manual(values = c(1,1,1,0.3)) +
geom_h0() +
scale_y_continuous(limits = c(-1, 2.5))
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
stat_summary(aes(time, net_mig_share), fun.y = "mean", colour = "red", size = 2, geom = "line") +
scale_alpha_manual(values = c(1,1,1,0.3)) +
geom_h0() +
scale_y_continuous(limits = c(-1, 2.5))
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
stat_summary(aes(time, net_mig_share), fun.y = "mean", geom = "line") +
scale_alpha_manual(values = c(1,1,1,0.3)) +
geom_h0() +
scale_y_continuous(limits = c(-1, 2.5))
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,0.3)) +
geom_h0() +
scale_y_continuous(limits = c(-1, 2.5))
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,0.3)) +
geom_h0() +
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,0.3)) +
geom_h0()
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,0.3)) +
geom_h0()
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,0.3)) +
geom_h0()
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,0.3)) +
geom_h0() +
coord_cartesian(ylim = c(-1, 2.5))
met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,0.3)) +
geom_h0() +
coord_cartesian(ylim = c(-1, 2.5))
net_met_mig <- met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M"), after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,0.3)) +
geom_h0() +
coord_cartesian(ylim = c(-1, 2.5))
net_met_mig <- met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN)
k <- net_met_mig %>%
group_by(time) %>%
summarise_if(is.numeric, sum) %>%
bind_rows(net_met_mig)
View(k)
k <- net_met_mig %>%
group_by(time) %>%
summarise_if(is.numeric, sum) %>%
mutate(metroreg = "Keskimäärin") %>%
bind_rows(net_met_mig) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M", "Keskimäärin"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M", "Keskimäärin"),
after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,0.3)) +
geom_h0() +
coord_cartesian(ylim = c(-1, 2.5))
net_met_mig %>%
group_by(time) %>%
summarise_if(is.numeric, sum) %>%
mutate(metroreg = "Keskimäärin") %>%
bind_rows(net_met_mig) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M", "Keskimäärin"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M", "Keskimäärin"),
after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,0.3)) +
geom_h0() +
coord_cartesian(ylim = c(-1, 2.5))
net_met_mig %>%
group_by(time) %>%
summarise_if(is.numeric, sum) %>%
mutate(metroreg = "Keskimäärin") %>%
bind_rows(net_met_mig) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M", "Keskimäärin"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M", "Keskimäärin"),
after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,1,0.3)) +
geom_h0() +
coord_cartesian(ylim = c(-1, 2.5))
net_met_mig %>%
group_by(time) %>%
summarise_if(is.numeric, sum) %>%
mutate(metroreg = "Keskimäärin") %>% View()
bind_rows(net_met_mig) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M", "Keskimäärin"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M", "Keskimäärin"),
after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,1,0.3)) +
geom_h0() +
coord_cartesian(ylim = c(-1, 2.5))
net_met_mig %>%
group_by(time) %>%
summarise_if(is.numeric, sum) %>%
mutate(metroreg = "Keskimäärin") %>%
bind_rows(net_met_mig) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M", "Keskimäärin"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M", "Keskimäärin"),
after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,1,0.3)) +
geom_h0() +
coord_cartesian(ylim = c(-1, 2.5))
net_met_mig %>%
group_by(time) %>%
summarise_if(is.numeric, sum) %>%
mutate(metroreg = "Keskimäärin") %>%
bind_rows(net_met_mig) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M", "Keskimäärin"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M", "Keskimäärin"),
after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,1,0.2)) +
geom_h0() +
coord_cartesian(ylim = c(-1, 2.5))
# eurostat::ea_countries
countries <- c("BE", "DE", "FR", "IE", "NL", "AT", "FI", "SE", "DK")
net_met_mig <- met_dat %>%
filter(indic_de %in% c("CNMIGRAT", "JAN")) %>%   # netmigration and population january
filter(!grepl("_NM", metroreg)) %>%
mutate(country = substr(metroreg, 1, 2)) %>%   # countrycode
filter(country %in% countries) %>%
spread(indic_de, values)
net_met_mig %>%
group_by(time) %>%
summarise_if(is.numeric, sum) %>%
mutate(metroreg = "Keskimäärin") %>%
bind_rows(net_met_mig) %>%
mutate(net_mig_share = 100 * CNMIGRAT / JAN) %>%
mutate(high_reg = fct_other(metroreg, keep = c("FI001MC", "FI002M", "FI003M", "Keskimäärin"),
other_level = "muut"),
metroreg = fct_relevel(metroreg, c("FI001MC", "FI002M", "FI003M", "Keskimäärin"),
after = Inf)) %>%
ggplot(aes(time, net_mig_share, group = metroreg, colour = high_reg, alpha = high_reg)) +
geom_line() +
scale_alpha_manual(values = c(1,1,1,1,0.2)) +
geom_h0() +
coord_cartesian(ylim = c(-1, 2.5))
