getwd()
paste(getwd(), "/R/data_clean", sep = "")
data0 <- pxweb_interactive()
data0 <- interactive_pxweb()
library(tidyr)
library(dplyr)
library(statfitools)
library(pxweb)
data0 <- interactive_pxweb()
head(data0)
data <- data0
# Remove redundant columns
data <- data %>% select(-Sukupuoli, -Ikä)
head(data)
str(data)
# Change the type of Vuosi column
data$Vuosi <- as.integer(as.character(data$Vuosi))
str(data)
setwd(paste(getwd(), "/R/data_clean", sep = ""))
saveRDS(kuntien_sisaiset_muutot, file = "kuntien_sisaiset_muutot.rds")
# Name data set
kuntien_sisaiset_muutot <- data
# Save data
setwd(paste(getwd(), "/R/data_clean", sep = ""))
saveRDS(kuntien_sisaiset_muutot, file = "R/data_clean/kuntien_sisaiset_muutot.rds")
getwd()
setwd("C:/Users/Omistaja/Pellervon Taloustutkimus PTT ry/KT162 Alueellinen liikkuvuus ja monipaikkaisuus - Osatavoite 2/KT162R")
getwd()
saveRDS(kuntien_sisaiset_muutot, file = "R/data_clean/kuntien_sisaiset_muutot.rds")
data0 <- interactive_pxweb()
head(data0)
# Remove redundant columns
data <- data %>% select(Vuosi, values)
head(data)
# Change names, name values might conflict when joining to other data sets.
names(data) <- c("Vuosi, Vakiluku")
args(loadRDS)
head(data)
# Suomen väkilukutiedot 1990-
data0 <-
get_pxweb_data(url = "http://pxnet2.stat.fi/PXWeb/api/v1/fi/StatFin/vrm/vaerak/statfin_vaerak_pxt_001.px",
dims = list(Vuosi = c('1990', '1991', '1992', '1993', '1994', '1995', '1996', '1997', '1998', '1999', '2000', '2001', '2002', '2003', '2004', '2005', '2006', '2007', '2008', '2009', '2010', '2011', '2012', '2013', '2014', '2015', '2016', '2017'),
Sukupuoli = c('S'),
Ikä = c('SSS'),
Tiedot = c('lkm')),
clean = TRUE)
data <- data0
# Remove redundant columns
data <- data %>% select(Vuosi, values)
# Change names, name values might conflict when joining to other data sets.
names(data) <- c("Vuosi", "Vakiluku")
# name data set
vakiluku <- data
# Save data
saveRDS(vakiluku, file = "R/data_clean/vakiluku")
head(data)
# Suomen väkilukutiedot 1990-
data0 <-
get_pxweb_data(url = "http://pxnet2.stat.fi/PXWeb/api/v1/fi/StatFin/vrm/vaerak/statfin_vaerak_pxt_001.px",
dims = list(Vuosi = c('1990', '1991', '1992', '1993', '1994', '1995', '1996', '1997', '1998', '1999', '2000', '2001', '2002', '2003', '2004', '2005', '2006', '2007', '2008', '2009', '2010', '2011', '2012', '2013', '2014', '2015', '2016', '2017'),
Sukupuoli = c('S'),
Ikä = c('SSS'),
Tiedot = c('lkm')),
clean = TRUE)
data <- data0
# Remove redundant columns
data <- data %>% select(Vuosi, values)
# Change names, name values might conflict when joining to other data sets.
names(data) <- c("Vuosi", "Vakiluku")
# name data set
vakiluku <- data
# Save data
saveRDS(vakiluku, file = "R/data_clean/vakiluku.rds")
# Suomen väkilukutiedot 1990-
data0 <-
get_pxweb_data(url = "http://pxnet2.stat.fi/PXWeb/api/v1/fi/StatFin/vrm/vaerak/statfin_vaerak_pxt_001.px",
dims = list(Vuosi = c('1990', '1991', '1992', '1993', '1994', '1995', '1996', '1997', '1998', '1999', '2000', '2001', '2002', '2003', '2004', '2005', '2006', '2007', '2008', '2009', '2010', '2011', '2012', '2013', '2014', '2015', '2016', '2017'),
Sukupuoli = c('S'),
Ikä = c('SSS'),
Tiedot = c('lkm')),
clean = TRUE)
data <- data0
# Remove redundant columns
data <- data %>% select(Vuosi, values)
# Change names, name values might conflict when joining to other data sets.
names(data) <- c("Vuosi", "vakiluku")
# name data set
vakiluku <- data
# Save data
saveRDS(vakiluku, file = "R/data_clean/vakiluku.rds")
lahtopendelointi_data <-
get_pxweb_data(url = "http://pxnet2.stat.fi/PXWeb/api/v1/fi/StatFin/vrm/tyokay/statfin_tyokay_pxt_013.px",
dims = list(Alue = c('020', '005', '009', '010', '016', '018', '019', '035', '043', '046', '047', '049', '050', '051', '052', '060', '061', '062', '065', '069', '071', '072', '074', '075', '076', '077', '078', '079', '081', '082', '086', '111', '090', '091', '097', '098', '099', '102', '103', '105', '106', '108', '109', '139', '140', '142', '143', '145', '146', '153', '148', '149', '151', '152', '165', '167', '169', '170', '171', '172', '176', '177', '178', '179', '181', '182', '186', '202', '204', '205', '208', '211', '213', '214', '216', '217', '218', '224', '226', '230', '231', '232', '233', '235', '236', '239', '240', '320', '241', '322', '244', '245', '249', '250', '256', '257', '260', '261', '263', '265', '271', '272', '273', '275', '276', '280', '284', '285', '286', '287', '288', '290', '291', '295', '297', '300', '301', '304', '305', '312', '316', '317', '318', '398', '399', '400', '407', '402', '403', '405', '408', '410', '416', '417', '418', '420', '421', '422', '423', '425', '426', '444', '430', '433', '434', '435', '436', '438', '440', '441', '475', '478', '480', '481', '483', '484', '489', '491', '494', '495', '498', '499', '500', '503', '504', '505', '508', '507', '529', '531', '535', '536', '538', '541', '543', '545', '560', '561', '562', '563', '564', '309', '576', '577', '578', '445', '580', '581', '599', '583', '854', '584', '588', '592', '593', '595', '598', '601', '604', '607', '608', '609', '611', '638', '614', '615', '616', '619', '620', '623', '624', '625', '626', '630', '631', '635', '636', '678', '710', '680', '681', '683', '684', '686', '687', '689', '691', '694', '697', '698', '700', '702', '704', '707', '729', '732', '734', '736', '790', '738', '739', '740', '742', '743', '746', '747', '748', '791', '749', '751', '753', '755', '758', '759', '761', '762', '765', '766', '768', '771', '777', '778', '781', '783', '831', '832', '833', '834', '837', '844', '845', '846', '848', '849', '850', '851', '853', '857', '858', '859', '886', '887', '889', '890', '892', '893', '895', '785', '905', '908', '911', '092', '915', '918', '921', '922', '924', '925', '927', '931', '934', '935', '936', '941', '946', '976', '977', '980', '981', '989', '992'),
Pendelöinti = c('*'),
Koulutusaste = c('*'),
Ikä = c('*'),
Vuosi = c('*')),
clean = TRUE)
# Change the type of the year variable
lahtopendelointi_data$Vuosi <- as.integer(as.character(lahtopendelointi_data$Vuosi))
library(pxweb)
library(tidyr)
library(dplyr)
lahtopendelointi_data <-
get_pxweb_data(url = "http://pxnet2.stat.fi/PXWeb/api/v1/fi/StatFin/vrm/tyokay/statfin_tyokay_pxt_013.px",
dims = list(Alue = c('020', '005', '009', '010', '016', '018', '019', '035', '043', '046', '047', '049', '050', '051', '052', '060', '061', '062', '065', '069', '071', '072', '074', '075', '076', '077', '078', '079', '081', '082', '086', '111', '090', '091', '097', '098', '099', '102', '103', '105', '106', '108', '109', '139', '140', '142', '143', '145', '146', '153', '148', '149', '151', '152', '165', '167', '169', '170', '171', '172', '176', '177', '178', '179', '181', '182', '186', '202', '204', '205', '208', '211', '213', '214', '216', '217', '218', '224', '226', '230', '231', '232', '233', '235', '236', '239', '240', '320', '241', '322', '244', '245', '249', '250', '256', '257', '260', '261', '263', '265', '271', '272', '273', '275', '276', '280', '284', '285', '286', '287', '288', '290', '291', '295', '297', '300', '301', '304', '305', '312', '316', '317', '318', '398', '399', '400', '407', '402', '403', '405', '408', '410', '416', '417', '418', '420', '421', '422', '423', '425', '426', '444', '430', '433', '434', '435', '436', '438', '440', '441', '475', '478', '480', '481', '483', '484', '489', '491', '494', '495', '498', '499', '500', '503', '504', '505', '508', '507', '529', '531', '535', '536', '538', '541', '543', '545', '560', '561', '562', '563', '564', '309', '576', '577', '578', '445', '580', '581', '599', '583', '854', '584', '588', '592', '593', '595', '598', '601', '604', '607', '608', '609', '611', '638', '614', '615', '616', '619', '620', '623', '624', '625', '626', '630', '631', '635', '636', '678', '710', '680', '681', '683', '684', '686', '687', '689', '691', '694', '697', '698', '700', '702', '704', '707', '729', '732', '734', '736', '790', '738', '739', '740', '742', '743', '746', '747', '748', '791', '749', '751', '753', '755', '758', '759', '761', '762', '765', '766', '768', '771', '777', '778', '781', '783', '831', '832', '833', '834', '837', '844', '845', '846', '848', '849', '850', '851', '853', '857', '858', '859', '886', '887', '889', '890', '892', '893', '895', '785', '905', '908', '911', '092', '915', '918', '921', '922', '924', '925', '927', '931', '934', '935', '936', '941', '946', '976', '977', '980', '981', '989', '992'),
Pendelöinti = c('*'),
Koulutusaste = c('*'),
Ikä = c('*'),
Vuosi = c('*')),
clean = TRUE)
# Change the type of the year variable
lahtopendelointi_data$Vuosi <- as.integer(as.character(lahtopendelointi_data$Vuosi))
lahtopendelointi_data1 <- lahtopendelointi_data[1:600000,]
# Lisää seutukunnat, maakunnat ja kuntatyypit dataan Huom! kuntaluokka-funktio tulee olla käytettävissä
# memory issues, computing in two chunks
lahtopendelointi_data1 <- mutate(lahtopendelointi_data1, seutukunta = kuntaluokka(Alue, "Seutukunta"))
# Funktio, joka lisää halutun kuntaluokituksen dataan
kuntaluokka <- function(kunta, luokittelu, vuosi = 2017)
{
vuosi <- as.character(vuosi)
url = paste("http://www.tilastokeskus.fi/static/media/uploads/meta/luokitukset/kooste_",
vuosi,
"_kaikki_kielet.xlsx", sep = "")
# if(!("kuntaluokitukset" %in% ls(globalenv()))) {
#    if("kuntaluokitukset.Rda" %in% dir()) {
#          load("kuntaluokitukset.Rda")
#  } else {
kuntaluokitukset <- statfitools::sf_get_reg_keytable(url = url)
keskuskunnat <- statfitools::keskuskunnat
kuntaluokitukset <- dplyr::left_join(kuntaluokitukset, keskuskunnat, by = "Kunta")
kuntaluokitukset$Keskusryhma[is.na(kuntaluokitukset$Keskusryhma)] <- "muu"
# }
#}
if(!(luokittelu %in% names(kuntaluokitukset))) {
stop("Desired luokittelu not in kuntaluokitukset.")
}
if(any(!(kunta %in% kuntaluokitukset$Kunta))) {
not_found <- kunta[!(kunta %in% kuntaluokitukset$Kunta)]
error_msg <- paste("The element(s)",
paste(not_found, collapse = ", "),
"in input kunta not recognized.")
stop(error_msg)
}
output <- sapply(kunta,
function(y) do.call(`$`, list(kuntaluokitukset, luokittelu))[kuntaluokitukset$Kunta == y])
names(output) <- NULL
unlist(output)
}
# Lisää seutukunnat, maakunnat ja kuntatyypit dataan Huom! kuntaluokka-funktio tulee olla käytettävissä
# memory issues, computing in two chunks
lahtopendelointi_data1 <- mutate(lahtopendelointi_data1, seutukunta = kuntaluokka(Alue, "Seutukunta"))
# Lisää seutukunnat, maakunnat ja kuntatyypit dataan Huom! kuntaluokka-funktio tulee olla käytettävissä
# memory issues, computing in two chunks
lahtopendelointi_data1 <- mutate(lahtopendelointi_data1, seutukunta = kuntaluokka(Alue, "Seutukunta"))
head(lahtopendelointi_data1)
lahtopendelointi_data1 <- mutate(lahtopendelointi_data1, maakunta = kuntaluokka(Alue, "Maakunta"))
lahtopendelointi_data1 <- mutate(lahtopendelointi_data1, kuntaryhmä = kuntaluokka(Alue, "Kuntaryhma"))
head(lahtopendelointi_data1)
lahtopendelointi_data2 <- mutate(lahtopendelointi_data2, seutukunta = kuntaluokka(Alue, "Seutukunta"))
lahtopendelointi_data2 <- lahtopendelointi_data[600001:1259550,]
lahtopendelointi_data2 <- mutate(lahtopendelointi_data2, seutukunta = kuntaluokka(Alue, "Seutukunta"))
head(lahtopendelointi_data2)
lahtopendelointi_data2 <- mutate(lahtopendelointi_data2, maakunta = kuntaluokka(Alue, "Maakunta"))
head(lahtopendelointi_data2)
lahtopendelointi_data2 <- mutate(lahtopendelointi_data2, kuntaryhmä = kuntaluokka(Alue, "Kuntaryhma"))
head(lahtopendelointi_data2)
lahtopendeloiti_data <- rbind(lahtopendelointi_data1, lahtopendelointi_data2)
head(lahtopendelointi_data)
head(lahtopendelointi_data1)
head(lahtopendelointi_data2)
lahtopendelointi_data <- rbind(lahtopendelointi_data1, lahtopendelointi_data2)
head(lahtopendelointi_data)
# Save data
saveRDS(lahtopendelointi_data, file = "R/data_clean/lahtopendelointi_data.rds")
tulopendelointi_data <- interactive_pxweb()
tulopendelointi_data <- interactive_pxweb()
# Change the type of the year variable
tulopendelointi_data$Vuosi <- as.integer(as.character(tulopendelointi_data$Vuosi))
# Lisää seutukunnat, maakunnat ja kuntatyypit dataan Huom! kuntaluokka-funktio tulee olla käytettävissä
# memory issues, computing in two chunks
tulopendelointi_data1 <- tulopendelointi_data[1:400000,]
tulopendelointi_data2 <- tulopendelointi_data[400001,895680,]
tulopendelointi_data1 <- mutate(tulopendelointi_data1, seutukunta = kuntaluokka(Alue, "Seutukunta"))
tulopendelointi_data1 <- mutate(tulopendelointi_data1, maakunta = kuntaluokka(Alue, "Maakunta"))
tulopendelointi_data1 <- mutate(tulopendelointi_data1, kuntaryhmä = kuntaluokka(Alue, "Kuntaryhma"))
tulopendelointi_data2 <- mutate(tulopendelointi_data2, seutukunta = kuntaluokka(Alue, "Seutukunta"))
tulopendelointi_data2 <- mutate(tulopendelointi_data2, maakunta = kuntaluokka(Alue, "Maakunta"))
tulopendelointi_data2 <- mutate(tulopendelointi_data2, kuntaryhmä = kuntaluokka(Alue, "Kuntaryhma"))
head(tulopendelointi_data)
names(tulopendelointi_data) <- c("Alue", names(tulopendelointi)[2:6])
names(tulopendelointi_data) <- c("Alue", names(tulopendelointi_data)[2:6])
tulopendelointi_data1 <- tulopendelointi_data[1:400000,]
tulopendelointi_data2 <- tulopendelointi_data[400001,895680,]
tulopendelointi_data1 <- mutate(tulopendelointi_data1, seutukunta = kuntaluokka(Alue, "Seutukunta"))
tulopendelointi_data1 <- mutate(tulopendelointi_data1, maakunta = kuntaluokka(Alue, "Maakunta"))
tulopendelointi_data1 <- mutate(tulopendelointi_data1, kuntaryhmä = kuntaluokka(Alue, "Kuntaryhma"))
tulopendelointi_data2 <- mutate(tulopendelointi_data2, seutukunta = kuntaluokka(Alue, "Seutukunta"))
tulopendelointi_data2 <- mutate(tulopendelointi_data2, maakunta = kuntaluokka(Alue, "Maakunta"))
tulopendelointi_data2 <- mutate(tulopendelointi_data2, kuntaryhmä = kuntaluokka(Alue, "Kuntaryhma"))
head(tulopendelointi_data1)
head(tulopendelointi_data2)
tulopendelointi_data2 <- tulopendelointi_data[400001:895680,]
tulopendelointi_data2 <- mutate(tulopendelointi_data2, seutukunta = kuntaluokka(Alue, "Seutukunta"))
tulopendelointi_data2 <- mutate(tulopendelointi_data2, maakunta = kuntaluokka(Alue, "Maakunta"))
tulopendelointi_data2 <- mutate(tulopendelointi_data2, kuntaryhmä = kuntaluokka(Alue, "Kuntaryhma"))
head(tulopendelointi_data2)
tulopendelointi_data <- rbind(tulopendelointi_data1, tulopendelointi_data2)
# Save data
saveRDS(tulopendelointi_data, file = "R/data_clean/tulopendelointi_data.rds")
head(tulopendelointi_data)
# Pendelöintiaineisto
lahtopendelointi_data <-
get_pxweb_data(url = "http://pxnet2.stat.fi/PXWeb/api/v1/fi/StatFin/vrm/tyokay/statfin_tyokay_pxt_013.px",
dims = list(Alue = c('020', '005', '009', '010', '016', '018', '019', '035', '043', '046', '047', '049', '050', '051', '052', '060', '061', '062', '065', '069', '071', '072', '074', '075', '076', '077', '078', '079', '081', '082', '086', '111', '090', '091', '097', '098', '099', '102', '103', '105', '106', '108', '109', '139', '140', '142', '143', '145', '146', '153', '148', '149', '151', '152', '165', '167', '169', '170', '171', '172', '176', '177', '178', '179', '181', '182', '186', '202', '204', '205', '208', '211', '213', '214', '216', '217', '218', '224', '226', '230', '231', '232', '233', '235', '236', '239', '240', '320', '241', '322', '244', '245', '249', '250', '256', '257', '260', '261', '263', '265', '271', '272', '273', '275', '276', '280', '284', '285', '286', '287', '288', '290', '291', '295', '297', '300', '301', '304', '305', '312', '316', '317', '318', '398', '399', '400', '407', '402', '403', '405', '408', '410', '416', '417', '418', '420', '421', '422', '423', '425', '426', '444', '430', '433', '434', '435', '436', '438', '440', '441', '475', '478', '480', '481', '483', '484', '489', '491', '494', '495', '498', '499', '500', '503', '504', '505', '508', '507', '529', '531', '535', '536', '538', '541', '543', '545', '560', '561', '562', '563', '564', '309', '576', '577', '578', '445', '580', '581', '599', '583', '854', '584', '588', '592', '593', '595', '598', '601', '604', '607', '608', '609', '611', '638', '614', '615', '616', '619', '620', '623', '624', '625', '626', '630', '631', '635', '636', '678', '710', '680', '681', '683', '684', '686', '687', '689', '691', '694', '697', '698', '700', '702', '704', '707', '729', '732', '734', '736', '790', '738', '739', '740', '742', '743', '746', '747', '748', '791', '749', '751', '753', '755', '758', '759', '761', '762', '765', '766', '768', '771', '777', '778', '781', '783', '831', '832', '833', '834', '837', '844', '845', '846', '848', '849', '850', '851', '853', '857', '858', '859', '886', '887', '889', '890', '892', '893', '895', '785', '905', '908', '911', '092', '915', '918', '921', '922', '924', '925', '927', '931', '934', '935', '936', '941', '946', '976', '977', '980', '981', '989', '992'),
Pendelöinti = c('*'),
Koulutusaste = c('9', '3-4', '5-6', '7-8'),
Ikä = c('0-17', '18-24', '25-34', '35-44', '45-54', '55-64', '65-74', '75-'),
Vuosi = c('*')),
clean = TRUE)     # poista yhteensä luokat
# Change the type of the year variable
lahtopendelointi_data$Vuosi <- as.integer(as.character(lahtopendelointi_data$Vuosi))
# Lisää seutukunnat, maakunnat ja kuntatyypit dataan Huom! kuntaluokka-funktio tulee olla käytettävissä
# memory issues, computing in two chunks
lahtopendelointi_data1 <- lahtopendelointi_data[1:400000,]
lahtopendelointi_data2 <- lahtopendelointi_data[400001,895680,]
lahtopendelointi_data1 <- mutate(lahtopendelointi_data1, seutukunta = kuntaluokka(Alue, "Seutukunta"))
lahtopendelointi_data1 <- mutate(lahtopendelointi_data1, maakunta = kuntaluokka(Alue, "Maakunta"))
lahtopendelointi_data1 <- mutate(lahtopendelointi_data1, kuntaryhmä = kuntaluokka(Alue, "Kuntaryhma"))
lahtopendelointi_data2 <- mutate(lahtopendelointi_data2, seutukunta = kuntaluokka(Alue, "Seutukunta"))
lahtopendelointi_data2 <- mutate(lahtopendelointi_data2, maakunta = kuntaluokka(Alue, "Maakunta"))
lahtopendelointi_data2 <- mutate(lahtopendelointi_data2, kuntaryhmä = kuntaluokka(Alue, "Kuntaryhma"))
lahtopendelointi_data <- rbind(lahtopendelointi_data1, lahtopendelointi_data2)
# Save data
saveRDS(lahtopendelointi_data, file = "R/data_clean/lahtopendelointi_data.rds")
head(lahtopendelointi_data1)
lahtopendelointi_data2 <- lahtopendelointi_data[400001:895680,]
lahtopendelointi_data2 <- mutate(lahtopendelointi_data2, seutukunta = kuntaluokka(Alue, "Seutukunta"))
lahtopendelointi_data2 <- mutate(lahtopendelointi_data2, maakunta = kuntaluokka(Alue, "Maakunta"))
lahtopendelointi_data2 <- mutate(lahtopendelointi_data2, kuntaryhmä = kuntaluokka(Alue, "Kuntaryhma"))
lahtopendelointi_data <- rbind(lahtopendelointi_data1, lahtopendelointi_data2)
# Save data
saveRDS(lahtopendelointi_data, file = "R/data_clean/lahtopendelointi_data.rds")
lahtopendelointi_data2 <- lahtopendelointi_data[400001:895680,]
head(lahtopendelointi_data2)
head(lahtopendelointi_data)
tail(lahtopendelointi_data)
lahtopendelointi_data <-
get_pxweb_data(url = "http://pxnet2.stat.fi/PXWeb/api/v1/fi/StatFin/vrm/tyokay/statfin_tyokay_pxt_013.px",
dims = list(Alue = c('020', '005', '009', '010', '016', '018', '019', '035', '043', '046', '047', '049', '050', '051', '052', '060', '061', '062', '065', '069', '071', '072', '074', '075', '076', '077', '078', '079', '081', '082', '086', '111', '090', '091', '097', '098', '099', '102', '103', '105', '106', '108', '109', '139', '140', '142', '143', '145', '146', '153', '148', '149', '151', '152', '165', '167', '169', '170', '171', '172', '176', '177', '178', '179', '181', '182', '186', '202', '204', '205', '208', '211', '213', '214', '216', '217', '218', '224', '226', '230', '231', '232', '233', '235', '236', '239', '240', '320', '241', '322', '244', '245', '249', '250', '256', '257', '260', '261', '263', '265', '271', '272', '273', '275', '276', '280', '284', '285', '286', '287', '288', '290', '291', '295', '297', '300', '301', '304', '305', '312', '316', '317', '318', '398', '399', '400', '407', '402', '403', '405', '408', '410', '416', '417', '418', '420', '421', '422', '423', '425', '426', '444', '430', '433', '434', '435', '436', '438', '440', '441', '475', '478', '480', '481', '483', '484', '489', '491', '494', '495', '498', '499', '500', '503', '504', '505', '508', '507', '529', '531', '535', '536', '538', '541', '543', '545', '560', '561', '562', '563', '564', '309', '576', '577', '578', '445', '580', '581', '599', '583', '854', '584', '588', '592', '593', '595', '598', '601', '604', '607', '608', '609', '611', '638', '614', '615', '616', '619', '620', '623', '624', '625', '626', '630', '631', '635', '636', '678', '710', '680', '681', '683', '684', '686', '687', '689', '691', '694', '697', '698', '700', '702', '704', '707', '729', '732', '734', '736', '790', '738', '739', '740', '742', '743', '746', '747', '748', '791', '749', '751', '753', '755', '758', '759', '761', '762', '765', '766', '768', '771', '777', '778', '781', '783', '831', '832', '833', '834', '837', '844', '845', '846', '848', '849', '850', '851', '853', '857', '858', '859', '886', '887', '889', '890', '892', '893', '895', '785', '905', '908', '911', '092', '915', '918', '921', '922', '924', '925', '927', '931', '934', '935', '936', '941', '946', '976', '977', '980', '981', '989', '992'),
Pendelöinti = c('*'),
Koulutusaste = c('9', '3-4', '5-6', '7-8'),
Ikä = c('0-17', '18-24', '25-34', '35-44', '45-54', '55-64', '65-74', '75-'),
Vuosi = c('*')),
clean = TRUE)
# Change the type of the year variable
lahtopendelointi_data$Vuosi <- as.integer(as.character(lahtopendelointi_data$Vuosi))
# Lisää seutukunnat, maakunnat ja kuntatyypit dataan Huom! kuntaluokka-funktio tulee olla käytettävissä
# memory issues, computing in two chunks
lahtopendelointi_data1 <- lahtopendelointi_data[1:400000,]
lahtopendelointi_data2 <- lahtopendelointi_data[400001:895680,]
lahtopendelointi_data1 <- mutate(lahtopendelointi_data1, seutukunta = kuntaluokka(Alue, "Seutukunta"))
lahtopendelointi_data1 <- mutate(lahtopendelointi_data1, maakunta = kuntaluokka(Alue, "Maakunta"))
lahtopendelointi_data1 <- mutate(lahtopendelointi_data1, kuntaryhmä = kuntaluokka(Alue, "Kuntaryhma"))
lahtopendelointi_data2 <- mutate(lahtopendelointi_data2, seutukunta = kuntaluokka(Alue, "Seutukunta"))
lahtopendelointi_data2 <- mutate(lahtopendelointi_data2, maakunta = kuntaluokka(Alue, "Maakunta"))
lahtopendelointi_data2 <- mutate(lahtopendelointi_data2, kuntaryhmä = kuntaluokka(Alue, "Kuntaryhma"))
lahtopendelointi_data <- rbind(lahtopendelointi_data1, lahtopendelointi_data2)
# Save data
saveRDS(lahtopendelointi_data, file = "R/data_clean/lahtopendelointi_data.rds")
lahtopendelointi_data <-
get_pxweb_data(url = "http://pxnet2.stat.fi/PXWeb/api/v1/fi/StatFin/vrm/tyokay/statfin_tyokay_pxt_013.px",
dims = list(Alue = c('020', '005', '009', '010', '016', '018', '019', '035', '043', '046', '047', '049', '050', '051', '052', '060', '061', '062', '065', '069', '071', '072', '074', '075', '076', '077', '078', '079', '081', '082', '086', '111', '090', '091', '097', '098', '099', '102', '103', '105', '106', '108', '109', '139', '140', '142', '143', '145', '146', '153', '148', '149', '151', '152', '165', '167', '169', '170', '171', '172', '176', '177', '178', '179', '181', '182', '186', '202', '204', '205', '208', '211', '213', '214', '216', '217', '218', '224', '226', '230', '231', '232', '233', '235', '236', '239', '240', '320', '241', '322', '244', '245', '249', '250', '256', '257', '260', '261', '263', '265', '271', '272', '273', '275', '276', '280', '284', '285', '286', '287', '288', '290', '291', '295', '297', '300', '301', '304', '305', '312', '316', '317', '318', '398', '399', '400', '407', '402', '403', '405', '408', '410', '416', '417', '418', '420', '421', '422', '423', '425', '426', '444', '430', '433', '434', '435', '436', '438', '440', '441', '475', '478', '480', '481', '483', '484', '489', '491', '494', '495', '498', '499', '500', '503', '504', '505', '508', '507', '529', '531', '535', '536', '538', '541', '543', '545', '560', '561', '562', '563', '564', '309', '576', '577', '578', '445', '580', '581', '599', '583', '854', '584', '588', '592', '593', '595', '598', '601', '604', '607', '608', '609', '611', '638', '614', '615', '616', '619', '620', '623', '624', '625', '626', '630', '631', '635', '636', '678', '710', '680', '681', '683', '684', '686', '687', '689', '691', '694', '697', '698', '700', '702', '704', '707', '729', '732', '734', '736', '790', '738', '739', '740', '742', '743', '746', '747', '748', '791', '749', '751', '753', '755', '758', '759', '761', '762', '765', '766', '768', '771', '777', '778', '781', '783', '831', '832', '833', '834', '837', '844', '845', '846', '848', '849', '850', '851', '853', '857', '858', '859', '886', '887', '889', '890', '892', '893', '895', '785', '905', '908', '911', '092', '915', '918', '921', '922', '924', '925', '927', '931', '934', '935', '936', '941', '946', '976', '977', '980', '981', '989', '992'),
Pendelöinti = c('*'),
Koulutusaste = c('9', '3-4', '5-6', '7-8'),
Ikä = c('0-17', '18-24', '25-34', '35-44', '45-54', '55-64', '65-74', '75-'),
Vuosi = c('*')),
clean = TRUE)
# Change the type of the year variable
lahtopendelointi_data$Vuosi <- as.integer(as.character(lahtopendelointi_data$Vuosi))
head(lahtopendelointi_data)
tail(lahtopendelointi_data)
# Lisää seutukunnat, maakunnat ja kuntatyypit dataan Huom! kuntaluokka-funktio tulee olla käytettävissä
# memory issues, computing in two chunks
lahtopendelointi_data1 <- lahtopendelointi_data[1:400000,]
lahtopendelointi_data2 <- lahtopendelointi_data[400001:895680,]
head(lahtopendelointi_data1)
head(lahtopendelointi_data2)
lahtopendelointi_data2 <- mutate(lahtopendelointi_data2, seutukunta = kuntaluokka(Alue, "Seutukunta"))
head(lahtopendelointi_data2)
lahtopendelointi_data2 <- mutate(lahtopendelointi_data2, maakunta = kuntaluokka(Alue, "Maakunta"))
head(lahtopendelointi_data2)
lahtopendelointi_data2 <- mutate(lahtopendelointi_data2, kuntaryhmä = kuntaluokka(Alue, "Kuntaryhma"))
head(lahtopendelointi_data2)
head(lahtopendelointi_data1)
lahtopendelointi_data1 <- mutate(lahtopendelointi_data1, seutukunta = kuntaluokka(Alue, "Seutukunta"))
lahtopendelointi_data1 <- mutate(lahtopendelointi_data1, maakunta = kuntaluokka(Alue, "Maakunta"))
lahtopendelointi_data1 <- mutate(lahtopendelointi_data1, kuntaryhmä = kuntaluokka(Alue, "Kuntaryhma"))
head(lahtopendelointi_data1)
lahtopendelointi_data <- rbind(lahtopendelointi_data1, lahtopendelointi_data2)
lahtopendelointi_data1 <- mutate(lahtopendelointi_data1, seutukunta = kuntaluokka(Alue, "Seutukunta"))
head(lahtopendelointi_data1)
lahtopendelointi_data1 <- lahtopendelointi_data1 %>% select(Alue, Pendelöinti, Koulutusaste, Vuosi, Ikä, values, seutukunta, maakunta, kuntaryhmä)
head(lahtopendelointi_data1)
lahtopendelointi_data <- rbind(lahtopendelointi_data1, lahtopendelointi_data2)
head(lahtopendelointi_data)
# Save data
saveRDS(lahtopendelointi_data, file = "R/data_clean/lahtopendelointi_data.rds")
unique(lahtopendelointi_data$Pendelöinti)
load("C:/Users/Omistaja/Pellervon Taloustutkimus PTT ry/KT162 Alueellinen liikkuvuus ja monipaikkaisuus - Osatavoite 2/Kuvaajien R koodit/Siistitty data/pendelöinti.Rda")
head(pendelöinti)
lahtopendelointi_data0 <- lahtopendelointi_data %>% spread(Pendelöinti, values)
head(lahtopendelointi_data0)
lahtopendelointi_data <- lahtopendelointi_data %>% spread(Pendelöinti, values)
names(lahtopendelointi_data) <- c("alue", "koulutusaste", "vuosi", "ika", "seutukunta", "maakunta", "kuntaryhma",
"asuinkunnassaan_tyossakayvat", "pendeloivat", "tyolliset_yhteensa")
head(lahtopendelointi_data)
lahtopendelointi_data <- select(lahtopendelointi_data, - tyolliset_yhteensa) %>%
rename(lahtopendelointi = pendeloivat)
head(lahtopendelointi_data)
head(tulopendelointi_data)
tulopendelointi_data <- tulopendelointi_data %>% spread(Pendelöinti, values)
names(tulopendelointi_data) <- c("alue", "koulutusaste", "vuosi", "ika", "seutukunta", "maakunta", "kuntaryhma",
"asuinkunnassaan_tyossakayvat", "pendeloivat", "tyolliset_yhteensa")
tulopendelointi_data <- select(tulopendelointi_data, - tyolliset_yhteensa) %>%
rename(tulopendelointi = pendeloivat)
head(tulopendelointi_data)
pendelointi_data <- left_join(tulopendelointi_data, lahtopendelointi_data)
head(pendelointi_data)
tail(pendelointi_data)
head(lahtopendelointi_data)
head(lahtopendelointi_data)
head(tulopendelointi_data)
head(pendelöinti)
load("C:/Users/Omistaja/Pellervon Taloustutkimus PTT ry/KT162 Alueellinen liikkuvuus ja monipaikkaisuus - Osatavoite 2/Kuvaajien R koodit/Siistitty data/Pendelöinti asuinalueittain.Rda")
head(pendelöinti_data)
head(lahtopendelointi_data)
head(tulopendelointi_data)
lahtopendelointi_data <- readRDS("R/data_clean/lahtopendelointi_data.rds")
tulopendelointi_data <- readRDS("R/data_clean/tulopendelointi_data.rds")
head(lahtopendelointi_data)
lahtopendelointi_data <- lahtopendelointi_data %>% spread(Pendelöinti, values)
names(lahtopendelointi_data) <- c("alue", "koulutusaste", "vuosi", "ika", "seutukunta", "maakunta", "kuntaryhma",
"asuinkunnassaan_tyossakayvat", "pendeloivat", "tyolliset_yhteensa")
head(lahtopendelointi_data)
tulopendelointi_data <- tulopendelointi_data %>% spread(Pendelöinti, values)
names(tulopendelointi_data) <- c("alue", "koulutusaste", "vuosi", "ika", "seutukunta", "maakunta", "kuntaryhma",
"asuinkunnassaan_tyossakayvat", "pendeloivat", "tyolliset_yhteensa")
head(tulopendelointi_data)
lahtopendelointi_data <- readRDS("R/data_clean/lahtopendelointi_data.rds")
tulopendelointi_data <- readRDS("R/data_clean/tulopendelointi_data.rds")
lahtopendelointi_data <- lahtopendelointi_data %>% spread(Pendelöinti, values)
head(lahtopendelointi_data)
tulopendelointi_data <- readRDS("R/data_clean/tulopendelointi_data.rds")
tulopendelointi_data <- tulopendelointi_data %>% spread(Pendelöinti, values)
head(tulopendelointi_data)
names(tulopendelointi_data) <- c("alue", "koulutusaste", "vuosi", "ika", "seutukunta", "maakunta", "kuntaryhma",
"tyolliset_yhteensa", "asuinkunnassaan_tyossakayvat", "pendeloivat")
lahtopendelointi_data <- readRDS("R/data_clean/lahtopendelointi_data.rds")
lahtopendelointi_data <- lahtopendelointi_data %>% spread(Pendelöinti, values)
names(lahtopendelointi_data) <- c("alue", "koulutusaste", "vuosi", "ika", "seutukunta", "maakunta", "kuntaryhma",
"asuinkunnassaan_tyossakayvat", "pendeloivat", "tyolliset_yhteensa")
head(tulopendelointi_data)
head(lahtopendelointi_data)
lahtopendelointi_data <- select(lahtopendelointi_data, - tyolliset_yhteensa) %>%
rename(lahtopendelointi = pendeloivat)
tulopendelointi_data <- select(tulopendelointi_data, - tyolliset_yhteensa) %>%
rename(tulopendelointi = pendeloivat)
head(tulopendelointi_data)
head(lahtopendelointi_data)
pendelointi_data <- left_join(tulopendelointi_data, lahtopendelointi_data)
head(pendelointi_data)
head(pendelöinti)
# Save data
saveRDS(pendelointi_data, file = "R/data_clean/pendelointi_data.rds")
pendelointi_data %>% group_by(vuosi) %>%
summarize(pendelöijiä = sum(pendelöijät)) %>%
ggplot(aes(y = lahtopendelointi, x = vuosi)) +
geom_line() +
#ggtitle("Pendelöijien määrä Suomessa 1987 - 2015") + #Kuntien välinen pendelöinti
ylab("Pendelöijien määrä") +
xlab(NULL) +
scale_y_continuous(limits = c(400000,800000), labels = deci_comma)
pendelointi_data %>% group_by(vuosi) %>%
summarize(commuters = sum(lahtopendeloijat)) %>%
ggplot(aes(y = commuters, x = vuosi)) +
geom_line() +
#ggtitle("Pendelöijien määrä Suomessa 1987 - 2015") + #Kuntien välinen pendelöinti
ylab("Pendelöijien määrä") +
xlab(NULL) +
scale_y_continuous(limits = c(400000,800000), labels = deci_comma)
pendelointi_data %>% group_by(vuosi) %>%
summarize(commuters = sum(lahtopendelointi)) %>%
ggplot(aes(y = commuters, x = vuosi)) +
geom_line() +
#ggtitle("Pendelöijien määrä Suomessa 1987 - 2015") + #Kuntien välinen pendelöinti
ylab("Pendelöijien määrä") +
xlab(NULL) +
scale_y_continuous(limits = c(400000,800000), labels = deci_comma)
library(ggplot2)
search()
pendelointi_data %>% group_by(vuosi) %>%
summarize(commuters = sum(lahtopendelointi)) %>%
ggplot(aes(y = commuters, x = vuosi)) +
geom_line() +
#ggtitle("Pendelöijien määrä Suomessa 1987 - 2015") + #Kuntien välinen pendelöinti
ylab("Pendelöijien määrä") +
xlab(NULL) +
scale_y_continuous(limits = c(400000,800000), labels = deci_comma)
library(ggptt)
pendelointi_data %>% group_by(vuosi) %>%
summarize(commuters = sum(lahtopendelointi)) %>%
ggplot(aes(y = commuters, x = vuosi)) +
geom_line() +
#ggtitle("Pendelöijien määrä Suomessa 1987 - 2015") + #Kuntien välinen pendelöinti
ylab("Pendelöijien määrä") +
xlab(NULL) +
scale_y_continuous(limits = c(400000,800000), labels = deci_comma)
set_gg(theme_ptt(), "ptt")
pendelointi_data %>% group_by(vuosi) %>%
summarize(commuters = sum(lahtopendelointi)) %>%
ggplot(aes(y = commuters, x = vuosi)) +
geom_line() +
#ggtitle("Pendelöijien määrä Suomessa 1987 - 2015") + #Kuntien välinen pendelöinti
ylab("Pendelöijien määrä") +
xlab(NULL) +
scale_y_continuous(limits = c(400000,800000), labels = deci_comma)
pendelointi_data %>% group_by(vuosi) %>%
summarize(commuters = sum(tulopendelointi)) %>%
ggplot(aes(y = commuters, x = vuosi)) +
geom_line() +
#ggtitle("Pendelöijien määrä Suomessa 1987 - 2015") + #Kuntien välinen pendelöinti
ylab("Pendelöijien määrä") +
xlab(NULL) +
scale_y_continuous(limits = c(400000,800000), labels = deci_comma)
pendelöinti_data %>% group_by(vuosi) %>%
summarize(pendeloijat_yhteensa = sum(lahtopendelointi),
ei_pendelöijat_yhteensa = sum(asuinkunnassaan_työssakayvat)) %>%
mutate(pendelointiosuus = pendeloijat_yhteensa /
(pendeloijat_yhteensa + ei_pendeloijat_yhteensa)) %>%
ggplot(aes(y = pendelöintiosuus, x = vuosi)) +
geom_line() +
#ggtitle("Pendelöijien osuus työllisistä Suomessa 1987 - 2015") +
ylab("Pendelöijien osuus työllisistä") +
xlab(NULL) +
scale_y_continuous(limits = c(0.19,0.35), labels = percent_comma)
pendelointi_data %>% group_by(vuosi) %>%
summarize(pendeloijat_yhteensa = sum(lahtopendelointi),
ei_pendelöijat_yhteensa = sum(asuinkunnassaan_työssakayvat)) %>%
mutate(pendelointiosuus = pendeloijat_yhteensa /
(pendeloijat_yhteensa + ei_pendeloijat_yhteensa)) %>%
ggplot(aes(y = pendelöintiosuus, x = vuosi)) +
geom_line() +
#ggtitle("Pendelöijien osuus työllisistä Suomessa 1987 - 2015") +
ylab("Pendelöijien osuus työllisistä") +
xlab(NULL) +
scale_y_continuous(limits = c(0.19,0.35), labels = percent_comma)
pendelointi_data %>% group_by(vuosi) %>%
summarize(pendeloijat_yhteensa = sum(lahtopendelointi),
ei_pendelöijat_yhteensa = sum(asuinkunnassaan_tyossakayvat)) %>%
mutate(pendelointiosuus = pendeloijat_yhteensa /
(pendeloijat_yhteensa + ei_pendeloijat_yhteensa)) %>%
ggplot(aes(y = pendelöintiosuus, x = vuosi)) +
geom_line() +
#ggtitle("Pendelöijien osuus työllisistä Suomessa 1987 - 2015") +
ylab("Pendelöijien osuus työllisistä") +
xlab(NULL) +
scale_y_continuous(limits = c(0.19,0.35), labels = percent_comma)
pendelointi_data %>% group_by(vuosi) %>%
summarize(pendeloijat_yhteensa = sum(lahtopendelointi),
ei_pendeloijat_yhteensa = sum(asuinkunnassaan_tyossakayvat)) %>%
mutate(pendelointiosuus = pendeloijat_yhteensa /
(pendeloijat_yhteensa + ei_pendeloijat_yhteensa)) %>%
ggplot(aes(y = pendelöintiosuus, x = vuosi)) +
geom_line() +
#ggtitle("Pendelöijien osuus työllisistä Suomessa 1987 - 2015") +
ylab("Pendelöijien osuus työllisistä") +
xlab(NULL) +
scale_y_continuous(limits = c(0.19,0.35), labels = percent_comma)
pendelointi_data %>% group_by(vuosi) %>%
summarize(pendeloijat_yhteensa = sum(lahtopendelointi),
ei_pendeloijat_yhteensa = sum(asuinkunnassaan_tyossakayvat)) %>%
mutate(pendelointiosuus = pendeloijat_yhteensa /
(pendeloijat_yhteensa + ei_pendeloijat_yhteensa)) %>%
ggplot(aes(y = pendelointiosuus, x = vuosi)) +
geom_line() +
#ggtitle("Pendelöijien osuus työllisistä Suomessa 1987 - 2015") +
ylab("Pendelöijien osuus työllisistä") +
xlab(NULL) +
scale_y_continuous(limits = c(0.19,0.35), labels = percent_comma)
usethis::use_data_raw()
dir("data-raw")
aluetyyppi <- readxl::read_xls("data-raw/msindaluejaot10.xls")
aluetyyppi <- readxl::read_xls("data-raw/msindaluejaot10.xls")
library(tidyverse)
aluetyyppi <- readxl::read_xls("data-raw/msindaluejaot10.xls") %>%
mutate(kunta_no = statfitools::extract_code(Kunta),
kunta = statfitools::extract_name(Kunta),
aluetyyppi = coalesce(luokka2, Alueluokka))
aluetyyppi <- readxl::read_xls("data-raw/msindaluejaot10.xls") %>%
mutate(kunta_no = as_factor(statfitools::extract_code(Kunta, numbers_as_numeric = FALSE)),
kunta = as_factor(statfitools::extract_name(Kunta)),
aluetyyppi = coalesce(luokka2, Alueluokka))
aluetyyppi <- readxl::read_xls("data-raw/msindaluejaot10.xls") %>%
mutate(kunta_no = as_factor(statfitools::extract_code(Kunta, numbers_as_numeric = FALSE)),
kunta = as_factor(statfitools::extract_name(Kunta)),
aluetyyppi = coalesce(luokka2, Alueluokka)) %>%
select(kunta_no, kunta, aluetyyppi)
use_data(aluetyyppi, overwrite = TRUE)
